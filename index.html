<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Activities Toggle Checklist</title>
<style>
:root {
  --bg1: #12001f;
  --bg2: #001a33;
  --card: rgba(18, 8, 40, 0.55);
  --border: rgba(255,255,255,0.14);
  --text: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.72);
  --glow1: #ff5cf4;
  --glow2: #42f5ff;
  --glow3: #ffd36b;
  --pill: rgba(255,255,255,0.06);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color: var(--text);
  background:
    radial-gradient(1100px 700px at 20% 10%, rgba(255,92,244,0.22), transparent 55%),
    radial-gradient(900px 600px at 85% 25%, rgba(66,245,255,0.18), transparent 55%),
    radial-gradient(900px 650px at 50% 90%, rgba(255,211,107,0.12), transparent 60%),
    linear-gradient(160deg, var(--bg1), var(--bg2));
  min-height: 100vh;
}

header {
  padding: 22px 18px 12px;
  max-width: 1200px;
  margin: 0 auto;
}

h1 {
  margin: 0 0 6px 0;
  font-weight: 800;
  letter-spacing: 0.4px;
  text-shadow: 0 0 22px rgba(255,92,244,0.25), 0 0 28px rgba(66,245,255,0.18);
}

.sub {
  color: var(--muted);
  margin: 0 0 14px 0;
}

.toolbar {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  align-items: center;
  padding: 12px;
  border: 1px solid var(--border);
  background: var(--card);
  border-radius: 14px;
  backdrop-filter: blur(10px);
  box-shadow: 0 14px 40px rgba(0,0,0,0.25);
}

#q {
  flex: 1 1 320px;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px 12px;
  background: rgba(0,0,0,0.18);
  color: var(--text);
  outline: none;
}
#q:focus {
  border-color: rgba(66,245,255,0.55);
  box-shadow: 0 0 0 3px rgba(66,245,255,0.18);
}

.btn {
  border: 1px solid var(--border);
  background: rgba(0,0,0,0.18);
  color: var(--text);
  border-radius: 12px;
  padding: 10px 12px;
  cursor: pointer;
  transition: transform 0.05s ease, border-color 0.2s ease, box-shadow 0.2s ease;
  user-select: none;
}
.btn:hover {
  border-color: rgba(255,92,244,0.55);
  box-shadow: 0 0 0 3px rgba(255,92,244,0.14);
}
.btn:active {
  transform: translateY(1px);
}

main {
  max-width: 1200px;
  margin: 10px auto 28px;
  padding: 0 18px 24px;
}

details {
  border: 1px solid var(--border);
  background: var(--card);
  border-radius: 14px;
  backdrop-filter: blur(10px);
  margin: 10px 0;
  overflow: hidden;
}

summary {
  list-style: none;
  cursor: pointer;
  padding: 14px 14px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  user-select: none;
}
summary::-webkit-details-marker { display:none; }

.summaryLeft {
  display: flex;
  gap: 10px;
  align-items: baseline;
}
.sectionTitle {
  font-weight: 800;
  letter-spacing: 0.3px;
}
.sectionMeta {
  color: var(--muted);
  font-size: 0.92rem;
}

.pills {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  padding: 14px 14px 16px;
  border-top: 1px solid rgba(255,255,255,0.08);
}

.pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 10px 12px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color: var(--text);
  cursor: pointer;
  user-select: none;
  transition: transform 0.05s ease, background 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
  font-size: 0.95rem;
  line-height: 1.1;
}
.pill:hover {
  border-color: rgba(66,245,255,0.55);
  box-shadow: 0 0 0 3px rgba(66,245,255,0.12);
}
.pill[aria-pressed="true"] {
  background: linear-gradient(135deg, rgba(255,92,244,0.22), rgba(66,245,255,0.14));
  border-color: rgba(255,92,244,0.70);
  box-shadow: 0 0 0 3px rgba(255,92,244,0.12), 0 0 24px rgba(255,92,244,0.10);
}
.pill:active {
  transform: translateY(1px);
}

footer {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 18px 24px;
  color: var(--muted);
  font-size: 0.92rem;
}
.toast {
  position: fixed;
  left: 50%;
  bottom: 18px;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.55);
  border: 1px solid rgba(255,255,255,0.18);
  padding: 10px 12px;
  border-radius: 999px;
  backdrop-filter: blur(10px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
}
.toast.show { opacity: 1; }


/* --- Vaporwave hero + audio toggles --- */
#heroWrap {
  max-width: 1100px;
  margin: 18px auto 6px;
  padding: 0 18px;
}

.heroCard {
  position: relative;
  border-radius: 18px;
  padding: 14px 14px 12px;
  background: linear-gradient(135deg, rgba(255,0,200,0.14), rgba(0,255,255,0.10));
  border: 1px solid rgba(255,255,255,0.12);
  box-shadow: 0 10px 30px rgba(0,0,0,0.28);
  overflow: hidden;
}

.heroTitle {
  font-weight: 800;
  letter-spacing: 0.18em;
  text-transform: lowercase;
  margin: 2px 2px 10px;
  opacity: 0.95;
}

.heroVidFrame {
  position: relative;
  height: 240px;
  border-radius: 16px;
  overflow: hidden;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.12), rgba(0,0,0,0.55));
  border: 1px solid rgba(255,255,255,0.12);
  transform-style: preserve-3d;
  perspective: 700px;
  animation: heroTilt 7.5s ease-in-out infinite;
}

@keyframes heroTilt {
  0%, 100% { transform: rotateY(-10deg) rotateX(2deg); }
  50%      { transform: rotateY(10deg) rotateX(-2deg); }
}

#davidVid {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: saturate(1.25) contrast(1.08) hue-rotate(12deg);
  transform: scale(1.03);
}

.heroOverlay {
  pointer-events: none;
  position: absolute;
  inset: 0;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0.06) 0px,
      rgba(255,255,255,0.06) 1px,
      rgba(0,0,0,0) 3px,
      rgba(0,0,0,0) 5px
    ),
    radial-gradient(circle at 70% 20%, rgba(255,0,200,0.18), rgba(0,0,0,0) 55%),
    radial-gradient(circle at 20% 80%, rgba(0,255,255,0.18), rgba(0,0,0,0) 60%);
  mix-blend-mode: screen;
  opacity: 0.85;
}

.heroFallback {
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  padding: 16px;
  text-align: center;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(4px);
  color: rgba(255,255,255,0.92);
}

.heroFallback code {
  padding: 2px 6px;
  border-radius: 8px;
  background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.14);
}

.heroSub {
  margin-top: 10px;
  font-size: 0.92rem;
  opacity: 0.90;
}

/* Audio toggle buttons: intentionally "not like the others" */
.btn.btnAudio {
  border: 1px solid rgba(255,255,255,0.16);
  box-shadow: 0 6px 18px rgba(0,0,0,0.22);
}

.btn.btnPlop {
  background: linear-gradient(135deg, rgba(0,255,170,0.22), rgba(0,255,255,0.12));
}

.btn.btnMusic {
  background: linear-gradient(135deg, rgba(255,0,200,0.20), rgba(255,200,0,0.10));
}

.btn.btnAudio[aria-pressed="false"] {
  opacity: 0.72;
  filter: saturate(0.85);
}

</style>
</head>
<body>
<div id="heroWrap">
  <div class="heroCard" aria-label="Vaporwave intro">
    <div class="heroTitle">[ N O X ' S  A C T I V I T I E S  C H E C K L I S T ]</div>
    <div class="heroVidFrame">
      <video id="davidVid" autoplay loop muted playsinline preload="metadata">
        <source src="david_vaporwave.mp4" type="video/mp4">
      </video>
      <div class="heroOverlay" aria-hidden="true"></div>
      <div class="heroFallback" id="heroFallback">
        Drop a <code>david_vaporwave.mp4</code> file next to this HTML to see the rotating David head here.
      </div>
    </div>
    <div class="heroSub">Synthwave is off by default • Plop is on by default</div>
  </div>
</div>

<header>
  <h1>A c t i v i t i e s   ( c l i c k   t o   s e l e c t )</h1>
  <p class="sub">Click to toggle. Search to filter. Sections are collapsible. Your selections autosave on this device. Copy exports selected items comma-separated.</p>

  <div class="toolbar">
    <input id="q" type="search" placeholder="Search (e.g., breathe, cook, program) — 944 items" autocomplete="off">
    <button class="btn" id="copyBtn" type="button">Copy selected</button>
    <button class="btn" id="clearBtn" type="button">Clear all</button>
    <button class="btn" id="expandBtn" type="button">Expand all</button>
    <button class="btn" id="collapseBtn" type="button">Collapse all</button>
        <button class="btn btnAudio btnPlop" id="plopToggleBtn" type="button" aria-pressed="true" title="Toggle plop sounds">Plop: On</button>
    <button class="btn btnAudio btnMusic" id="musicToggleBtn" type="button" aria-pressed="false" title="Toggle synthwave background">Music: Off</button>
    <span id="count" class="sectionMeta"></span>
  </div>
</header>

<main id="app"></main>

<footer>
  b y  N o x  F a m o u s ,  c i r c a   [December 16th 2025]
</footer>

<div class="toast" id="toast">Copied.</div>

<audio id="bgMusic" src="synthwave_loop.wav" loop preload="auto"></audio>

<script>

// --- Audio state (plop + synthwave) ---
let plopEnabled = true;   // plop is ON by default
let musicEnabled = false; // music is OFF by default
const LS_PLOP = "vap_plop_on";
const LS_MUSIC = "vap_music_on";

const ITEMS = ['breathing','blinking','swallowing','chewing','stretching','yawning','standing','sitting','walking','running','jogging','jumping','crawling','balancing','bending','lifting','carrying','pulling','pushing','climbing','falling asleep','waking up','sneezing','coughing','sweating','shivering','napping','sleeping','warming up','cooling down','drinking','eating','tasting','sniffing','touching','hearing','seeing','smelling','speaking','whispering','humming','singing','laughing','crying','smiling','frowning','sighing','groaning','daydreaming','thinking','cooking','boiling water','frying food','baking','washing dishes','vacuuming','sweeping','mopping','folding clothes','doing laundry','ironing','cleaning windows','making the bed','showering','brushing teeth','shaving','combing hair','applying lotion','getting dressed','undressing','grocery shopping','refilling prescriptions','paying bills','budgeting','taking out the trash','recycling','opening mail','organizing drawers','writing lists','meal prepping','packing bags','unpacking','calling someone','texting','sending emails','waiting in line','commuting','checking the weather','reading instructions','setting reminders','locking doors','charging devices','making coffee','making tea','watering plants','feeding pets','taking medication','using the bathroom','washing hands','tidying up','listening','empathizing','consoling someone','encouraging someone','complimenting','apologizing','forgiving','debating','arguing','negotiating','mediating','comforting someone','reflecting on feelings','journaling emotions','setting boundaries','giving advice','asking questions','telling stories','meeting new people','introducing yourself','attending a party','hosting guests','networking','hugging','handshaking','high-fiving','waving','nodding','making eye contact','avoiding eye contact','confessing something','comfort eating','venting','cry-laughing','feeling nostalgia','feeling anxiety','feeling joy','feeling frustration','feeling excitement','feeling curiosity','caring for others','caring for yourself','practicing gratitude','setting goals','daydreaming about the future','reminiscing','missing someone','letting go','sharing secrets','keeping secrets','reading','writing','editing','brainstorming','proofreading','memorizing','solving puzzles','analyzing data','calculating','strategizing','planning','organizing','designing','drawing','sketching','painting','sculpting','crafting','knitting','crocheting','sewing','quilting','woodworking','pottery','photography','filming','video editing','sound recording','mixing audio','playing music','improvising','composing','acting','dancing','choreographing','storyboarding','illustrating','calligraphy','graphic design','making memes','collaging','worldbuilding','writing poetry','writing fiction','solving riddles','strategizing games','making playlists','mapping routes','inventing things','hiking','biking','swimming','surfing','kayaking','canoeing','sailing','paddleboarding','trail running','rock climbing','bouldering','skateboarding','rollerblading','ice skating','skiing','snowboarding','snowshoeing','sledding','fishing','hunting','gardening','planting trees','mowing the lawn','weeding','composting','feeding wildlife','birdwatching','stargazing','camping','building a campfire','pitching a tent','orienteering','foraging','mushroom hunting','chopping wood','jogging with a dog','throwing a frisbee','playing catch','yoga','pilates','weightlifting','boxing','kickboxing','stretching routines','aerobics','martial arts','tai chi','qi gong','fencing','archery','horseback riding','barrel racing','vaulting','mountain hiking','trail clearing','parkour','jump roping','trampoline jumping','rowing','scuba diving','snorkeling','spearfishing','cliff jumping','paragliding','skydiving','ziplining','uphill biking','downhill biking','inline skating','cross-country skiing','sprinting','playing soccer','playing basketball','playing volleyball','playing tennis','playing badminton','table tennis','wrestling','swimming laps','diving','water polo','long jumping','high jumping','javelin throwing','hammer throw','shot put','gymnastics','cheerleading','tumbling','baton twirling','handstands','cartwheeling','unicycling','balance beam practice','slacklining','running errands','walking a dog','exploring parks','watching sunsets','browsing the internet','watching YouTube','streaming shows','doomscrolling','online shopping','scrolling social media','posting photos','commenting','liking posts','sharing content','messaging friends','video calling','voice chatting','gaming','speedrunning','modding games','streaming on Twitch','editing VODs','coding','programming','debugging','writing scripts','designing websites','UI/UX design','building apps','learning languages online','taking digital notes','using spreadsheets','managing calendars','file organizing','running virtual meetings','using AI tools','typing','copy-pasting','dragging files','installing software','updating drivers','troubleshooting tech','building PCs','backing up data','creating presentations','graphic editing','photo retouching','3D modeling','Blender sculpting','creating animations','writing code snippets','creating bots','API testing','cybersecurity practice','ethical hacking','data entry','data analysis','spreadsheet modeling','managing digital finances','using crypto wallets','VR gaming','AR experiences','drone flying','making digital art','editing sprite sheets','creating GIFs','using filters','coding neural networks','training ML models','animating sprites','writing fanfic','curating Pinterest boards','designing wallpapers','blogging','vlogging','creating tutorials','recording podcasts','scheduling posts','writing newsletters','troubleshooting Wi-Fi','updating firmware','creating databases','tagging metadata','using digital to-do lists','playing online chess','solving captchas','saving bookmarks','password managing','pixel art creation','using Discord','managing servers','moderating communities','setting server roles','creating channels','uploading emojis','building Notion dashboards','automating workflows','meditating','deep breathing','grounding exercises','mindfulness practice','mantra chanting','self-soothing','emotional regulation','identifying triggers','unpacking memories','visualizing success','reframing thoughts','body scanning','progressive muscle relaxation','shadow work','affirmations','seeking comfort','asking for help','therapy homework','introspection','goal tracking','building routines','habit stacking','reflecting on choices','reading self-help','journaling insights','writing affirmations','spending time alone','reconnecting with others','healing old wounds','forgiving yourself','practicing stillness','taking breaks','crying intentionally','understanding emotions','naming feelings','resting','napping intentionally','regulating stress','walking to think','pacing','dissociating','grounding in nature','cleansing your space','rearranging furniture','taking long showers','listening to calming music','singing in the shower','dancing alone','stretching in the morning','stimming','sensory seeking','sensory avoidance','aromatherapy','lighting candles','tidying your desk','drinking cold water','drinking warm tea','hugging a pillow','watching comfort shows','wearing soft clothes','petting animals','feeding birds','helping a friend','talking through problems','venting safely','asking clarifying questions','researching solutions','making decisions','delaying decisions','prioritizing tasks','saying no','saying yes','compromising','self-advocating','setting boundaries','maintaining boundaries','repairing relationships','ending relationships','grieving','celebrating','feeling pride','feeling relief','feeling anticipation','feeling uncertainty','working','commuting','replying to emails','attending meetings','brainstorming with coworkers','presenting ideas','taking notes','leading teams','collaborating','negotiating contracts','onboarding','training others','fixing equipment','restocking supplies','organizing inventory','project planning','scheduling tasks','time management','delegating','filing documents','archiving','reading reports','writing reports','troubleshooting systems','learning new skills','mentoring others','reviewing work','quality control','manufacturing tasks','customer service','answering phones','greeting clients','processing orders','transporting goods','driving cars','riding buses','cycling to work','navigating maps','booking appointments','managing finances','balancing accounts','calculating taxes','signing papers','reading legal documents','researching laws','contacting support','renewing licenses','studying','taking tests','attending classes','listening to lectures','writing essays','reading textbooks','highlighting notes','group study','memorization drills','practicing skills','prepping presentations','learning instruments','rehearsing music','conducting experiments','observing results','writing hypotheses','designing posters','participating in labs','attending workshops','joining clubs','tutoring','volunteering','donating items','participating in charity events','mentoring youth','community organizing','activism','advocacy','protesting','voting','writing petitions','speaking publicly','debating ideas','educating others','raising awareness','fundraising','building community projects','stretching before exercise','cooling down after workouts','taking vitamins','applying sunscreen','moisturizing','trimming nails','clipping toenails','brushing hair','conditioning hair','exfoliating skin','shaving body hair','shaving beard','brushing teeth','flossing','mouthwash rinsing','applying deodorant','massaging muscles','self-checking vitals','first aid','treating cuts','bandaging wounds','using ice packs','heating pads','stretching injured muscles','physical therapy exercises','med tracking','taking prescriptions','scheduling appointments','attending medical checkups','attending therapy','researching symptoms','doing breathwork','resting in bed','lowering stress','drinking electrolytes','improving posture','stretching neck','standing breaks at desk','drinking herbal tea','meditating with apps','taking long baths','aromatherapy showers','going for health walks','cooking healthy meals','reducing sugar intake','tracking calories','measuring weight','getting massages','chiropractic visits','stretching hamstrings','stretching back','stretching shoulders','planning trips','packing luggage','unpacking luggage','booking flights','booking hotels','riding taxis','taking buses','riding subways','taking ferries','boarding planes','going through security','waiting in airports','traveling abroad','learning travel phrases','sampling foreign foods','sightseeing','hiking mountains','exploring forests','visiting lakes','visiting beaches','walking in cities','taking photos','navigating new places','collecting souvenirs','meeting locals','renting bikes','stargazing outdoors','camping under stars','exploring caves','swimming in rivers','visiting waterfalls','taking scenic drives','road tripping','using maps','booking tours','traveling solo','traveling with friends','navigating airports','trying local cafés','trying new cuisines','washing clothes','drying clothes','folding clothes','ironing clothes','organizing closets','sorting laundry','repairing clothes','sewing buttons','handwashing delicate fabrics','cleaning kitchen counters','scrubbing pans','disinfecting surfaces','organizing pantries','stocking food','meal planning','chopping vegetables','frying meals','roasting food','boiling pasta','making soups','baking cakes','making bread','decorating pastries','setting the table','washing floors','vacuuming carpets','scrubbing bathrooms','unclogging drains','fixing leaks','organizing cables','emptying trash bins','recycling plastics','composting food scraps','maintaining tools','painting walls','hanging shelves','assembling furniture','cleaning windows','raising blinds','lowering blinds','sweeping patios','watering gardens','trimming plants','raking leaves','shoveling snow','salting sidewalks','maintaining yard tools','maintaining appliances','changing light bulbs','changing smoke alarm batteries','organizing drawers','decluttering rooms','labeling boxes','storing seasonal items','watching movies','binge-watching shows','rewatching favorites','listening to music','discovering new artists','making playlists','attending concerts','going to festivals','watching plays','attending theatre','going to museums','going to art galleries','doing puzzles','solving sudoku','solving crosswords','reading novels','reading nonfiction','reading poetry','reading comics','collecting manga','visiting bookstores','joining book clubs','listening to podcasts','writing reviews','watching documentaries','going bowling','playing mini-golf','playing darts','playing billiards','board gaming','card gaming','tabletop RPGs','painting miniatures','cosplaying','attending conventions','karaoke','traveling for fun','trying new restaurants','visiting cafés','watching sports','participating in sports','collecting items','journaling memories','scrapbooking','making photo albums','practicing magic tricks','attending workshops','exploring hobbies','learning new recipes','doing taste tests','hiking trails','taking scenic photos','budgeting monthly expenses','tracking spending','updating spreadsheets','paying rent','paying utilities','reviewing bank statements','transferring funds','depositing checks','grocery shopping','comparing prices','coupon clipping','returning items','mailing packages','picking up parcels','renewing subscriptions','canceling subscriptions','repairing electronics','ordering supplies','replacing batteries','washing the car','refueling the car','checking tire pressure','changing oil','maintaining bicycles','fixing flat tires','booking maintenance','filling out forms','filing taxes','organizing receipts','making new friends','maintaining friendships','comforting loved ones','planning hangouts','meeting for coffee','giving gifts','receiving gifts','writing letters','sending postcards','celebrating birthdays','celebrating anniversaries','attending weddings','attending funerals','visiting family','hosting gatherings','cooking for friends','sharing meals','checking in on people','mediating conflicts','resolving misunderstandings','offering support','asking for support','learning boundaries','practicing assertiveness','giving compliments','receiving compliments','flirting','dating','introspecting about relationships','navigating heartbreak','rebuilding confidence','expressing affection','expressing gratitude','saying goodbye','saying hello','apologizing sincerely','initiating conversations','deep listening','empathizing deeply','praying','meditating in silence','lighting incense','reading sacred texts','contemplating existence','practicing gratitude','attending spiritual gatherings','connecting with nature','walking labyrinths','chanting','journaling spiritually','making altars','leaving offerings','mindful breathing','vow setting','storytelling','creating characters','worldbuilding','writing essays','writing scripts','podcast scripting','painting murals','sculpting clay','composing music','mixing music','beat making','singing in harmonies','dancing freestyle','choreographing dances','writing poetry','performing poetry','creating zines','designing posters','journaling fiction ideas','scrapbooking memories','collecting art references','photographing nature','photographing people','staging photoshoots','retouching photos','animating 2D art','animating 3D scenes','drawing digitally','pixel art design','sprite sheet creation','VFX design','storyboard creation','writing comic panels','designing outfits','costuming','prop making','observing nature','collecting samples','cataloging findings','doing science experiments','tracking weather','building simple machines','studying physics','studying chemistry','studying biology','studying astronomy','solving math problems','writing equations','modeling data','observing stars','using telescopes','collecting rocks','identifying minerals','logging field notes','reading research articles','participating in citizen science','exploring museums','stretching after sleep','reacting to news','forming opinions','changing opinions','feeling inspired','feeling discouraged','overcoming fear','procrastinating','planning future goals','sharing experiences','rewriting memories','replaying conversations','laughing at memes','sending voice notes','reacting with emojis','analyzing dreams','making wishes','evaluating risks','managing impulses','resisting temptations','indulging desires','oversharing','holding back','expressing vulnerability','rehearsing conversations','feeling déjà vu','sensing danger','adapting to change','seeking closure','embracing new routines','reshaping identity','grieving past versions of yourself','romanticizing life','savoring moments','cherishing memories','striving for purpose','nurturing curiosity','exploring possibilities','wandering aimlessly','cultivating patience','navigating uncertainty','repairing mistakes','creating new habits','breaking old habits','evolving','learning continuously','being human'];

const LS_KEY = "activity_pills_selected_v2";
const LS_OPEN = "activity_pills_open_v2";

let selected = new Set();
try {
  const raw = localStorage.getItem(LS_KEY);
  if (raw) {
    const arr = JSON.parse(raw);
    if (Array.isArray(arr)) selected = new Set(arr);
  }
} catch(e) {}

let openState = {};
try {
  const raw = localStorage.getItem(LS_OPEN);
  if (raw) openState = JSON.parse(raw) || {};
} catch(e) {}

const app = document.getElementById("app");
const q = document.getElementById("q");
const countEl = document.getElementById("count");
const toast = document.getElementById("toast");
const plopToggleBtn = document.getElementById("plopToggleBtn");
const musicToggleBtn = document.getElementById("musicToggleBtn");
const bgMusic = document.getElementById("bgMusic");

function syncAudioButtons() {
  if (plopToggleBtn) {
    plopToggleBtn.setAttribute("aria-pressed", plopEnabled ? "true" : "false");
    plopToggleBtn.textContent = plopEnabled ? "Plop: On" : "Plop: Off";
  }
  if (musicToggleBtn) {
    musicToggleBtn.setAttribute("aria-pressed", musicEnabled ? "true" : "false");
    musicToggleBtn.textContent = musicEnabled ? "Music: On" : "Music: Off";
  }
}

// restore saved states (plop defaults ON, music defaults OFF)
try {
  const p = localStorage.getItem(LS_PLOP);
  if (p !== null) plopEnabled = (p === "1");
  // Music intentionally defaults OFF on load.
} catch(e) {}

syncAudioButtons();

// Music stays OFF on page load (browser gesture rules + your preference).
// Hero video fallback: hide hint if the video actually loads
try {
  const vid = document.getElementById("davidVid");
  const fb = document.getElementById("heroFallback");
  if (vid && fb) {
    const hide = () => { fb.style.display = "none"; };
    const show = () => { fb.style.display = ""; };
    vid.addEventListener("canplay", hide);
    vid.addEventListener("playing", hide);
    vid.addEventListener("error", show);
    // If the browser already has enough data
    if (vid.readyState >= 2) hide();
  }
} catch(e) {}


function saveSelected() {
  try { localStorage.setItem(LS_KEY, JSON.stringify([...selected])); } catch(e) {}
}
function saveOpen() {
  try { localStorage.setItem(LS_OPEN, JSON.stringify(openState)); } catch(e) {}
}

function chunk(arr, size) {
  const out = [];
  for (let i = 0; i < arr.length; i += size) out.push(arr.slice(i, i + size));
  return out;
}

function showToast(msg) {
  toast.textContent = msg;
  toast.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.classList.remove("show"), 1200);
}

function normalize(s) {
  return (s || "").toLowerCase().trim();
}

function render() {
  const term = normalize(q.value);
  const list = term ? ITEMS.filter(x => normalize(x).includes(term)) : ITEMS.slice();

  const groups = chunk(list, 100);

  app.innerHTML = "";
  let shown = 0;

  groups.forEach((g, idx) => {
    const start = idx*100 + 1;
    const end = idx*100 + g.length;
    const key = `sec_${idx}`;

    const det = document.createElement("details");
    const shouldOpen = (key in openState) ? !!openState[key] : (idx === 0);
    det.open = shouldOpen;

    det.addEventListener("toggle", () => {
      openState[key] = det.open;
      saveOpen();
    });

    const sum = document.createElement("summary");
    const left = document.createElement("div");
    left.className = "summaryLeft";
    const title = document.createElement("div");
    title.className = "sectionTitle";
    title.textContent = `Items ${start}–${end}`;
    const meta = document.createElement("div");
    meta.className = "sectionMeta";
    const secSelected = g.filter(x => selected.has(x)).length;
    meta.textContent = `${secSelected} selected`;
    left.appendChild(title);
    left.appendChild(meta);

    const right = document.createElement("div");
    right.className = "sectionMeta";
    right.textContent = term ? `${g.length} match` : `${g.length} items`;

    sum.appendChild(left);
    sum.appendChild(right);

    const pills = document.createElement("div");
    pills.className = "pills";

    g.forEach((label) => {
      const b = document.createElement("div");
      b.className = "pill";
      b.setAttribute("role", "button");
      b.setAttribute("tabindex", "0");
      b.setAttribute("aria-pressed", selected.has(label) ? "true" : "false");
      b.dataset.label = label;
      b.textContent = label;
      pills.appendChild(b);
      shown += 1;
    });

    det.appendChild(sum);
    det.appendChild(pills);
    app.appendChild(det);
  });

  countEl.textContent = `${shown} shown • ${selected.size} selected`;
}

function updateSectionMetaFast() {
  const details = app.querySelectorAll("details");
  details.forEach(det => {
    const pills = det.querySelectorAll(".pill");
    let secSel = 0;
    pills.forEach(p => {
      if (p.getAttribute("aria-pressed") === "true") secSel++;
    });
    const meta = det.querySelector(".summaryLeft .sectionMeta");
    if (meta) meta.textContent = `${secSel} selected`;
  });
  countEl.textContent = `${app.querySelectorAll(".pill").length} shown • ${selected.size} selected`;
}

// Gentle plop sound (WebAudio)
let audioCtx = null;

function plop() {
  if (!plopEnabled) return;
  try {
    audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === "suspended") audioCtx.resume();

    const t = audioCtx.currentTime;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    const filt = audioCtx.createBiquadFilter();

    // Slightly wider pitch variation + tiny detune so repeats feel less identical
    const base = 170 + Math.random() * 160; // 170–330 Hz (was 180–300)
    const drop = 0.68 + Math.random() * 0.18; // 0.68–0.86 (was 0.75)

    osc.type = "sine";
    osc.detune.setValueAtTime((Math.random() * 2 - 1) * 12, t); // ±12 cents
    osc.frequency.setValueAtTime(base, t);
    osc.frequency.exponentialRampToValueAtTime(Math.max(60, base * drop), t + 0.10);

    filt.type = "lowpass";
    filt.frequency.setValueAtTime(1200, t);
    filt.frequency.exponentialRampToValueAtTime(500, t + 0.12);

    gain.gain.setValueAtTime(0.0001, t);
    gain.gain.exponentialRampToValueAtTime(0.30, t + 0.01); // ~3× louder (was 0.10)
    gain.gain.exponentialRampToValueAtTime(0.0001, t + 0.14);

    osc.connect(filt);
    filt.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start(t);
    osc.stop(t + 0.16);
  } catch(e) {}
}


// --- Tiny procedural synthwave loop (royalty-free because it's generated) ---
let musicNodes = null; // { master, delay, comp }
let musicTimer = null;
let nextNoteTime = 0;
let step16 = 0;

const TEMPO = 92;               // chill synthwave
const LOOKAHEAD_MS = 25;        // scheduler tick
const SCHEDULE_AHEAD = 0.12;    // seconds
const STEPS_PER_BEAT = 4;       // 16th notes

function ensureAudio() {
  audioCtx = audioCtx || new (window.AudioContext || window.webkitAudioContext)();
  if (audioCtx.state === "suspended") audioCtx.resume();
  return audioCtx;
}

function midiToHz(m) { return 440 * Math.pow(2, (m - 69) / 12); }

function env(g, t, a, d, s, r, peak=1.0) {
  // Simple ADSR-ish envelope on GainNode g.gain
  g.gain.cancelScheduledValues(t);
  g.gain.setValueAtTime(0.0001, t);
  g.gain.exponentialRampToValueAtTime(Math.max(0.0002, peak), t + a);
  g.gain.exponentialRampToValueAtTime(Math.max(0.0002, peak * s), t + a + d);
  g.gain.exponentialRampToValueAtTime(0.0001, t + a + d + r);
}

function makeNoiseBuffer(ctx, seconds=1.0) {
  const len = Math.floor(ctx.sampleRate * seconds);
  const buf = ctx.createBuffer(1, len, ctx.sampleRate);
  const data = buf.getChannelData(0);
  for (let i=0; i<len; i++) data[i] = (Math.random() * 2 - 1);
  return buf;
}

let noiseBuf = null;

function scheduleKick(t) {
  const ctx = ensureAudio();
  const o = ctx.createOscillator();
  const g = ctx.createGain();

  o.type = "sine";
  o.frequency.setValueAtTime(120, t);
  o.frequency.exponentialRampToValueAtTime(52, t + 0.09);

  g.gain.setValueAtTime(0.0001, t);
  g.gain.exponentialRampToValueAtTime(0.55, t + 0.005);
  g.gain.exponentialRampToValueAtTime(0.0001, t + 0.12);

  o.connect(g);
  g.connect(musicNodes.master);

  o.start(t);
  o.stop(t + 0.14);
}

function scheduleSnare(t) {
  const ctx = ensureAudio();
  noiseBuf = noiseBuf || makeNoiseBuffer(ctx, 0.6);

  const src = ctx.createBufferSource();
  const bp = ctx.createBiquadFilter();
  const g = ctx.createGain();

  src.buffer = noiseBuf;

  bp.type = "bandpass";
  bp.frequency.setValueAtTime(1800, t);
  bp.Q.setValueAtTime(0.9, t);

  g.gain.setValueAtTime(0.0001, t);
  g.gain.exponentialRampToValueAtTime(0.22, t + 0.003);
  g.gain.exponentialRampToValueAtTime(0.0001, t + 0.10);

  src.connect(bp);
  bp.connect(g);
  g.connect(musicNodes.master);

  src.start(t);
  src.stop(t + 0.11);
}

function scheduleHat(t, open=false) {
  const ctx = ensureAudio();
  noiseBuf = noiseBuf || makeNoiseBuffer(ctx, 0.6);

  const src = ctx.createBufferSource();
  const hp = ctx.createBiquadFilter();
  const g = ctx.createGain();

  src.buffer = noiseBuf;

  hp.type = "highpass";
  hp.frequency.setValueAtTime(6000, t);

  const peak = open ? 0.085 : 0.05;
  const dur  = open ? 0.09  : 0.035;

  g.gain.setValueAtTime(0.0001, t);
  g.gain.exponentialRampToValueAtTime(peak, t + 0.002);
  g.gain.exponentialRampToValueAtTime(0.0001, t + dur);

  src.connect(hp);
  hp.connect(g);
  g.connect(musicNodes.master);

  src.start(t);
  src.stop(t + dur + 0.01);
}

function scheduleBass(t, midi, len=0.20) {
  const ctx = ensureAudio();
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  const f = ctx.createBiquadFilter();

  o.type = "sawtooth";
  o.frequency.setValueAtTime(midiToHz(midi), t);

  f.type = "lowpass";
  f.frequency.setValueAtTime(600, t);
  f.frequency.exponentialRampToValueAtTime(220, t + Math.max(0.05, len * 0.8));
  f.Q.setValueAtTime(1.1, t);

  g.gain.setValueAtTime(0.0001, t);
  g.gain.exponentialRampToValueAtTime(0.13, t + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, t + len);

  o.connect(f);
  f.connect(g);
  g.connect(musicNodes.master);

  o.start(t);
  o.stop(t + len + 0.02);
}

function schedulePad(t, rootMidi, len=1.6) {
  const ctx = ensureAudio();
  // simple minor 7-ish chord: root, m3, 5, b7
  const chord = [0, 3, 7, 10].map(x => rootMidi + x);
  chord.forEach((m, i) => {
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    const f = ctx.createBiquadFilter();

    o.type = "triangle";
    o.frequency.setValueAtTime(midiToHz(m) * (i === 0 ? 0.5 : 1.0), t); // fatten root
    o.detune.setValueAtTime((Math.random() * 2 - 1) * 9, t); // tiny drift

    f.type = "lowpass";
    f.frequency.setValueAtTime(950, t);
    f.Q.setValueAtTime(0.7, t);

    g.gain.setValueAtTime(0.0001, t);
    g.gain.exponentialRampToValueAtTime(0.032, t + 0.12);
    g.gain.exponentialRampToValueAtTime(0.0001, t + len);

    o.connect(f);
    f.connect(g);
    g.connect(musicNodes.delay);

    o.start(t);
    o.stop(t + len + 0.04);
  });
}

function initMusicGraph() {
  const ctx = ensureAudio();

  const master = ctx.createGain();
  master.gain.setValueAtTime(0.075, ctx.currentTime); // intentionally low

  const comp = ctx.createDynamicsCompressor();
  comp.threshold.setValueAtTime(-24, ctx.currentTime);
  comp.knee.setValueAtTime(18, ctx.currentTime);
  comp.ratio.setValueAtTime(4, ctx.currentTime);
  comp.attack.setValueAtTime(0.01, ctx.currentTime);
  comp.release.setValueAtTime(0.12, ctx.currentTime);

  const delay = ctx.createDelay();
  delay.delayTime.setValueAtTime(0.26, ctx.currentTime);

  const fb = ctx.createGain();
  fb.gain.setValueAtTime(0.22, ctx.currentTime);

  // routing: master -> comp -> destination
  // plus a little delay loop on the side
  master.connect(comp);
  comp.connect(ctx.destination);

  master.connect(delay);
  delay.connect(fb);
  fb.connect(delay);
  delay.connect(comp);

  musicNodes = { master, comp, delay, fb };
}

function scheduleStep(step, time) {
  // Drum grid (16ths)
  const beat = step % 16;

  // Kick on 1 and 3 (0 and 8)
  if (beat === 0 || beat === 8) scheduleKick(time);

  // Snare on 2 and 4 (4 and 12)
  if (beat === 4 || beat === 12) scheduleSnare(time);

  // Hats: 8ths, with a little open hat on the "and" of 4
  if (beat % 2 === 0) scheduleHat(time, false);
  if (beat === 14) scheduleHat(time, true);

  // Bass pattern (A minor-ish): A2, A2, G2, A2, C3, B2, G2, A2
  const bassSeq = [45,45,43,45,48,47,43,45]; // MIDI
  if (beat % 2 === 0) { // 8th notes
    const idx = (step/2) % bassSeq.length;
    scheduleBass(time, bassSeq[idx], 0.18);
  }

  // Pad: once per bar
  if (beat === 0) {
    const roots = [57, 55, 53, 55]; // A3, G3, F3, G3
    const bar = Math.floor(step / 16) % roots.length;
    schedulePad(time, roots[bar], 1.55);
  }
}

function scheduler() {
  const ctx = ensureAudio();
  while (nextNoteTime < ctx.currentTime + SCHEDULE_AHEAD) {
    scheduleStep(step16, nextNoteTime);

    const secondsPerBeat = 60.0 / TEMPO;
    nextNoteTime += secondsPerBeat / STEPS_PER_BEAT; // 16ths
    step16 = (step16 + 1) % 64; // 4 bars
  }
}

function startMusic() {
  if (musicEnabled) return;
  musicEnabled = true;

  // Prefer the included audio file (synthwave_loop.wav) if present
  if (bgMusic) {
    try {
      bgMusic.volume = 0.30;
      const p = bgMusic.play();
      if (p && p.catch) p.catch(() => {});
      return;
    } catch (e) {}
  }

  const ctx = ensureAudio();
  if (!musicNodes) initMusicGraph();

  // gentle fade-in
  musicNodes.master.gain.cancelScheduledValues(ctx.currentTime);
  musicNodes.master.gain.setValueAtTime(0.0001, ctx.currentTime);
  musicNodes.master.gain.exponentialRampToValueAtTime(0.075, ctx.currentTime + 0.25);

  step16 = 0;
  nextNoteTime = ctx.currentTime + 0.05;
  clearInterval(musicTimer);
  musicTimer = setInterval(scheduler, LOOKAHEAD_MS);
}

function stopMusic() {
  if (!musicEnabled) return;
  musicEnabled = false;

  if (bgMusic) {
    try {
      bgMusic.pause();
      // keep position (more 'tape deck' vibe); comment next line if you prefer reset
      // bgMusic.currentTime = 0;
    } catch (e) {}
  }

  const ctx = ensureAudio();
  if (musicTimer) clearInterval(musicTimer);
  musicTimer = null;

  if (musicNodes) {
    // fade out, then keep graph around (so it can come back smoothly)
    musicNodes.master.gain.cancelScheduledValues(ctx.currentTime);
    musicNodes.master.gain.setValueAtTime(Math.max(0.0001, musicNodes.master.gain.value), ctx.currentTime);
    musicNodes.master.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.25);
  }
}

function setMusic(on) {
  if (on) startMusic();
  else stopMusic();
  try { localStorage.setItem(LS_MUSIC, on ? "1" : "0"); } catch(e) {}
}

function setPlop(on) {
  plopEnabled = !!on;
  try { localStorage.setItem(LS_PLOP, plopEnabled ? "1" : "0"); } catch(e) {}
}

function toggleLabel(label, pillEl) {
  if (selected.has(label)) {
    selected.delete(label);
    pillEl.setAttribute("aria-pressed", "false");
  } else {
    selected.add(label);
    pillEl.setAttribute("aria-pressed", "true");
  }
  saveSelected();
  plop();
  updateSectionMetaFast();
}

app.addEventListener("click", (ev) => {
  const pill = ev.target.closest(".pill");
  if (!pill) return;
  ev.preventDefault();
  ev.stopPropagation();
  toggleLabel(pill.dataset.label, pill);
});

app.addEventListener("keydown", (ev) => {
  const pill = ev.target.closest(".pill");
  if (!pill) return;
  if (ev.key === "Enter" || ev.key === " ") {
    ev.preventDefault();
    toggleLabel(pill.dataset.label, pill);
  }
});

document.getElementById("copyBtn").addEventListener("click", async () => {
  const out = [...selected].sort((a,b)=>a.localeCompare(b));
  const text = out.join(", ");
  if (!text) {
    showToast("Nothing selected.");
    return;
  }
  try {
    await navigator.clipboard.writeText(text);
    showToast("Copied selections.");
  } catch (e) {
    const ta = document.createElement("textarea");
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    showToast("Copied selections.");
  }
});

document.getElementById("clearBtn").addEventListener("click", () => {
  selected.clear();
  saveSelected();
  app.querySelectorAll(".pill").forEach(p => p.setAttribute("aria-pressed", "false"));
  updateSectionMetaFast();
  showToast("Cleared.");
});

document.getElementById("expandBtn").addEventListener("click", () => {
  app.querySelectorAll("details").forEach((d, idx) => {
    d.open = true;
    openState[`sec_${idx}`] = true;
  });
  saveOpen();
});

document.getElementById("collapseBtn").addEventListener("click", () => {
  app.querySelectorAll("details").forEach((d, idx) => {
    d.open = false;
    openState[`sec_${idx}`] = false;
  });
  saveOpen();
});

let _t = null;
q.addEventListener("input", () => {
  clearTimeout(_t);
  _t = setTimeout(render, 80);
});


// --- Audio toggle button wiring ---
if (plopToggleBtn) {
  plopToggleBtn.addEventListener("click", (ev) => {
    ev.preventDefault();
    ev.stopPropagation();
    const next = !plopEnabled;
    setPlop(next);
    syncAudioButtons();
    // Give a confirmation plop only when turning ON
    if (plopEnabled) plop();
  });
}

if (musicToggleBtn) {
  musicToggleBtn.addEventListener("click", (ev) => {
    ev.preventDefault();
    ev.stopPropagation();
    const next = !musicEnabled;
    setMusic(next);
    syncAudioButtons();
    // Optional tactile feedback (respects plop toggle)
    plop();
  });
}


render();
</script>
</body>
</html>
